import{c as d,r as a,b as i,j as e,S as C,R as P}from"../../browser-polyfill.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],U=d("Check",S);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],L=d("Globe",I);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],E=d("Key",$);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],R=d("User",M);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],T=d("X",_),z=()=>{const[o,m]=a.useState({isAuthenticated:!1,apiUrl:"http://127.0.0.1:3210"}),[b,B]=a.useState(""),[n,p]=a.useState(""),[l,c]=a.useState(!1),[u,r]=a.useState(null),[f,j]=a.useState(null),[y,x]=a.useState(null),[w,g]=a.useState(!1);a.useEffect(()=>{h()},[]);const h=async()=>{var t;try{const s=await i.storage.local.get(["pulseAuth","pulseApiUrl"]);j(s),(t=s.pulseAuth)!=null&&t.token&&m({isAuthenticated:!0,user:s.pulseAuth.user,workspace:s.pulseAuth.workspace,apiUrl:s.pulseApiUrl||"http://127.0.0.1:3210"}),p(s.pulseApiUrl||"http://127.0.0.1:3210")}catch(s){console.error("Failed to load settings:",s)}},N=async()=>{c(!0),r(null);try{console.log("Sending auth message to background script...");const t=await i.runtime.sendMessage({action:"auth",data:{type:"pat",token:b.trim()||"web-auth",apiUrl:n}});if(console.log("Background script response:",t),t&&t.success)t.result.type==="redirect"?(r({type:"success",text:t.result.message}),r({type:"success",text:`Web app opened! After signing in, click "I'm signed in" below.`}),g(!0),c(!1)):(await h(),r({type:"success",text:"Successfully authenticated!"}));else{const s=(t==null?void 0:t.error)||"Authentication failed";throw x(`Background script error: ${s}`),new Error(s)}}catch(t){console.error("Authentication failed:",t);const s=t instanceof Error?t.message:"Authentication failed";x(`Full error: ${s}`),r({type:"error",text:s}),c(!1)}},v=async()=>{c(!0);try{const t=await i.runtime.sendMessage({action:"auth",data:{type:"confirm_auth"}});if(t&&t.success)await h(),g(!1),r({type:"success",text:"Successfully authenticated!"});else throw new Error((t==null?void 0:t.error)||"Confirmation failed")}catch(t){console.error("Confirmation failed:",t),r({type:"error",text:"Confirmation failed. Please try again."})}finally{c(!1)}},k=async()=>{try{await i.runtime.sendMessage({action:"auth",data:{type:"logout"}}),m({isAuthenticated:!1,apiUrl:n}),g(!1),r({type:"success",text:"Successfully logged out"})}catch(t){console.error("Logout failed:",t),r({type:"error",text:"Logout failed"})}},A=async()=>{try{await i.storage.local.set({pulseApiUrl:n}),m(t=>({...t,apiUrl:n})),r({type:"success",text:"API URL saved"})}catch(t){console.error("Failed to save API URL:",t),r({type:"error",text:"Failed to save API URL"})}};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(C,{size:24,className:"text-blue-600"}),"Pulse Web Clipper Settings"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure your connection to Pulse"})]}),e.jsxs("div",{className:"px-6 py-6",children:[u&&e.jsxs("div",{className:`mb-6 p-4 rounded-md flex items-center gap-2 ${u.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[u.type==="success"?e.jsx(U,{size:16}):e.jsx(T,{size:16}),u.text]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(L,{size:20}),"Pulse API URL"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Base URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:n,onChange:t=>p(t.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"http://127.0.0.1:3210"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Save"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use http://127.0.0.1:3210 for development or your Pulse instance URL"})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(R,{size:20}),"Authentication Status"]}),o.isAuthenticated?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"✓ Connected to Pulse"}),o.user&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Signed in as ",o.user.name," (",o.user.email,")"]}),o.workspace&&e.jsxs("p",{className:"text-sm text-green-600",children:["Workspace: ",o.workspace.name]})]}),e.jsx("button",{onClick:k,className:"px-3 py-1 text-sm text-red-600 hover:text-red-800 border border-red-300 rounded-md hover:bg-red-50",children:"Disconnect"})]})}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"⚠ Not connected to Pulse"}),e.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Please authenticate below to start clipping content"})]})]}),!o.isAuthenticated&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(E,{size:20}),"Connect to Pulse"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Click the button below to authenticate with your Pulse account. This will open the Pulse web app where you can sign in."}),w?e.jsx("button",{onClick:v,disabled:l,className:`w-full py-2 px-4 rounded-md font-medium ${l?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"}`,children:l?"Confirming...":"I'm signed in to Pulse"}):e.jsx("button",{onClick:N,disabled:l,className:`w-full py-2 px-4 rounded-md font-medium ${l?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"}`,children:l?"Opening web app...":"Sign in to Pulse"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"How to Use"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("ol",{className:"text-sm text-blue-800 space-y-2",children:[e.jsx("li",{children:'1. Click "Sign in to Pulse" above to authenticate with your account'}),e.jsx("li",{children:"2. Sign in to Pulse in the opened web app tab"}),e.jsx("li",{children:"3. Return to this extension page - it will automatically detect your authentication"}),e.jsx("li",{children:"4. Navigate to any webpage you want to clip"}),e.jsx("li",{children:"5. Click the Pulse extension icon or use the context menu"}),e.jsx("li",{children:"6. Choose your capture options and destination"}),e.jsx("li",{children:'7. Click "Capture to Pulse" to save the content'})]})})]})]}),e.jsxs("div",{className:"mt-8 border-t pt-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Debug Information"}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Storage Contents:"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap mb-4",children:JSON.stringify(f,null,2)}),y&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-red-600",children:"Last Error:"}),e.jsx("pre",{className:"text-xs text-red-600 whitespace-pre-wrap mb-4 bg-red-50 p-2 rounded",children:y})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"px-3 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Refresh Debug Info"}),e.jsx("button",{onClick:async()=>{try{console.log("Testing API endpoint...");const t=await fetch(`${n}/api/clipper/auth`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer test-token"}});console.log("Test response status:",t.status);const s=await t.text();console.log("Test response body:",s),x(`Direct fetch test: Status ${t.status}, Body: ${s}`)}catch(t){console.error("Direct fetch test failed:",t),x(`Direct fetch test failed: ${t instanceof Error?t.message:t}`)}},className:"px-3 py-1 text-xs bg-blue-200 text-blue-700 rounded hover:bg-blue-300",children:"Test API Endpoint"})]})]})]})]})})})},D=P.createRoot(document.getElementById("root"));D.render(e.jsx(z,{}));
