(function(){"use strict";chrome.runtime.onMessage.addListener((e,o,t)=>{var r,a;switch(e.action){case"getSelection":t({selection:(r=window.getSelection())==null?void 0:r.toString(),url:window.location.href,title:document.title});break;case"extractContent":try{const c={url:window.location.href,title:document.title,content:m(),selection:((a=window.getSelection())==null?void 0:a.toString().trim())||"",metadata:h()};t({success:!0,content:c})}catch(c){console.error("Content extraction failed:",c),t({success:!1,error:c instanceof Error?c.message:"Unknown error"})}break;case"captureScreenshot":return f().then(t),!0;case"highlightSelection":d();break;default:console.warn("Unknown content script action:",e.action)}});async function f(){try{return(await chrome.runtime.sendMessage({action:"captureVisibleTab"})).dataUrl}catch(e){return console.error("Screenshot capture failed:",e),null}}function d(){const e=window.getSelection();if(!e||e.rangeCount===0)return;const o=e.getRangeAt(0);if(o.collapsed)return;const t=document.createElement("span");t.style.backgroundColor="#3b82f6",t.style.color="white",t.style.padding="2px 4px",t.style.borderRadius="4px",t.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)";try{o.surroundContents(t),setTimeout(()=>{if(t.parentNode){const r=t.parentNode;r.replaceChild(document.createTextNode(t.textContent||""),t),r.normalize()}},2e3)}catch(r){console.error("Could not highlight selection:",r)}}function h(){const e={url:window.location.href,title:document.title,description:"",image:"",author:"",publishedTime:"",canonical:window.location.href},o=document.querySelector('meta[name="description"]');o&&(e.description=o.content);const t=document.querySelector('meta[property="og:title"]'),r=document.querySelector('meta[property="og:description"]'),a=document.querySelector('meta[property="og:image"]'),c=document.querySelector('meta[property="og:url"]');t&&(e.title=t.content),r&&(e.description=r.content),a&&(e.image=a.content),c&&(e.canonical=c.content);const s=document.querySelector('meta[name="author"]'),u=document.querySelector('meta[property="article:published_time"]');s&&(e.author=s.content),u&&(e.publishedTime=u.content);const n=document.querySelector('link[rel="canonical"]');return n&&(e.canonical=n.href),e}function m(){const e=["main",'[role="main"]',".content",".post-content",".entry-content",".article-content","article",".main-content"];for(const o of e){const t=document.querySelector(o);if(t)return p(t)}return p(document.body)}function p(e){const o=e.cloneNode(!0);["script","style","nav","header","footer",".advertisement",".ads",".social-share",".comments",".sidebar"].forEach(n=>{const i=o.querySelectorAll(n);for(const l of i)l.remove()});let r="";return o.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(n=>{const i=Number.parseInt(n.tagName.slice(1),10),l="#".repeat(i);n.textContent=`${l} ${n.textContent}`}),o.querySelectorAll("pre code, pre").forEach(n=>{const i=n.textContent||"";n.textContent=`\`\`\`
${i}
\`\`\``}),o.querySelectorAll("code").forEach(n=>{n.closest("pre")||(n.textContent=`\`${n.textContent}\``)}),o.querySelectorAll("a[href]").forEach(n=>{const i=n.href,l=n.textContent||"";i&&i!==l&&(n.textContent=`[${l}](${i})`)}),r=o.textContent||"",r=r.replace(/\n\s*\n\s*\n/g,`

`).replace(/^\s+|\s+$/g,"").trim(),r}window.pulseClipper={getPageMetadata:h,extractMainContent:m,getSelection:()=>{var e;return((e=window.getSelection())==null?void 0:e.toString())||""},highlightSelection:d}})();
